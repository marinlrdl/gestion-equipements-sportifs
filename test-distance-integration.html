<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test IntÃ©gration - SystÃ¨me de Distance</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #0055A4;
        }
        .test-result {
            background: #e8f5e8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 3px solid #00A94F;
        }
        .test-error {
            background: #ffe8e8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 3px solid #E63946;
        }
        button {
            background: #0055A4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #003d7a;
        }
        #console-output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ Test d'IntÃ©gration - SystÃ¨me de Distance</h1>
    
    <div class="test-section">
        <h2>Tests des FonctionnalitÃ©s</h2>
        <button onclick="testerFormuleHaversine()">ğŸ“ Test Formule Haversine</button>
        <button onclick="testerEquipementsProches()">ğŸ¯ Test Ã‰quipements Proches</button>
        <button onclick="testerGeolocalisation()">ğŸŒ Test GÃ©olocalisation</button>
        <button onclick="executerTousTests()">ğŸš€ Tous les Tests</button>
        <button onclick="effacerConsole()">ğŸ—‘ï¸ Effacer Console</button>
    </div>

    <div class="test-section">
        <h2>Simulation GÃ©olocalisation</h2>
        <p>CoordonnÃ©es de test (Paris): <strong>48.8566, 2.3522</strong></p>
        <button onclick="simulerGeolocalisation()">ğŸ“ Simuler GÃ©olocalisation</button>
    </div>

    <div class="test-section">
        <h2>Ã‰quipements de Test</h2>
        <div id="equipements-test">
            <p>Chargement des Ã©quipements de test...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Console de Test</h2>
        <div id="console-output">PrÃªt pour les tests...\n</div>
    </div>

    <!-- Scripts de test -->
    <script src="js/distance.js"></script>
    <script src="js/test-distance.js"></script>
    
    <script>
        // Rediriger la console vers la page de test
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ') + '\n';
            consoleOutput.textContent += message;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        // DonnÃ©es de test
        const equipementsTest = [
            {
                id: 1,
                equip_nom: 'Terrain de Tennis - Parc Monceau',
                inst_adresse: '35 Boulevard de Courcelles',
                commune_nom: 'Paris 17e',
                latitude: 48.8809,
                longitude: 2.3143,
                densite_actuelle: 60,
                capacite_max: 100
            },
            {
                id: 2,
                equip_nom: 'Piscine Georges Hermant',
                inst_adresse: '17 Rue Georges Hermant',
                commune_nom: 'Paris 19e',
                latitude: 48.8838,
                longitude: 2.3824,
                densite_actuelle: 85,
                capacite_max: 100
            },
            {
                id: 3,
                equip_nom: 'Stade SÃ©bastien CharlÃ©ty',
                inst_adresse: '61 Avenue Pierre de Coubertin',
                commune_nom: 'Paris 13e',
                latitude: 48.8315,
                longitude: 2.3522,
                densite_actuelle: 30,
                capacite_max: 200
            },
            {
                id: 4,
                equip_nom: 'Centre Aquatique Jacqueline Douet',
                inst_adresse: '20 Rue Albert Thomas',
                commune_nom: 'Paris 10e',
                latitude: 48.8741,
                longitude: 2.3475,
                densite_actuelle: 75,
                capacite_max: 150
            }
        ];
        
        // Afficher les Ã©quipements de test
        function afficherEquipementsTest() {
            const container = document.getElementById('equipements-test');
            const html = equipementsTest.map(equip => {
                const taux = calculerTauxOccupation(equip);
                return `
                    <div class="test-result">
                        <strong>${equip.equip_nom}</strong><br>
                        ğŸ“ ${equip.inst_adresse}, ${equip.commune_nom}<br>
                        ğŸŒ ${equip.latitude}, ${equip.longitude}<br>
                        ğŸ“Š Taux occupation: ${taux}%
                    </div>
                `;
            }).join('');
            container.innerHTML = html;
        }
        
        // Tests individuels
        function testerFormuleHaversine() {
            console.log('ğŸ”¬ TEST: Formule de Haversine');
            
            // Test Paris-Lyon
            const distanceParisLyon = calculerDistanceHaversine(48.8566, 2.3522, 45.7640, 4.8357);
            console.log(`Paris-Lyon: ${distanceParisLyon} km`);
            
            // Test mÃªme point
            const distanceNulle = calculerDistanceHaversine(48.8566, 2.3522, 48.8566, 2.3522);
            console.log(`MÃªme point: ${distanceNulle} km`);
            
            // Validation
            if (distanceParisLyon > 390 && distanceParisLyon < 395 && distanceNulle === 0) {
                console.log('âœ… Test Haversine: RÃ‰USSI');
            } else {
                console.log('âŒ Test Haversine: Ã‰CHEC');
            }
        }
        
        function testerEquipementsProches() {
            console.log('ğŸ¯ TEST: Ã‰quipements Proches');
            
            const userLat = 48.8566;  // Paris centre
            const userLon = 2.3522;
            
            const proches = trouverEquipementsProches(userLat, userLon, equipementsTest, 4, false);
            console.log(`TrouvÃ© ${proches.length} Ã©quipements proches:`);
            
            proches.forEach((equip, index) => {
                console.log(`${index + 1}. ${equip.equip_nom}: ${equip.distance} km`);
            });
            
            if (proches.length === 4 && proches[0].distance <= proches[1].distance) {
                console.log('âœ… Test Ã‰quipements Proches: RÃ‰USSI');
            } else {
                console.log('âŒ Test Ã‰quipements Proches: Ã‰CHEC');
            }
        }
        
        function testerGeolocalisation() {
            console.log('ğŸŒ TEST: GÃ©olocalisation');
            
            if (navigator.geolocation) {
                console.log('âœ… GÃ©olocalisation supportÃ©e par le navigateur');
                
                // Test avec timeout court pour Ã©viter de attendre
                const options = {
                    timeout: 1000,
                    maximumAge: 60000
                };
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log(`âœ… Position obtenu: ${position.coords.latitude}, ${position.coords.longitude}`);
                        console.log('âœ… Test GÃ©olocalisation: RÃ‰USSI');
                    },
                    (erreur) => {
                        console.log(`âš ï¸ GÃ©olocalisation Ã©chouÃ©e (attendu en test): ${erreur.message}`);
                        console.log('âœ… Test GÃ©olocalisation: RÃ‰USSI (erreur attendue)');
                    },
                    options
                );
            } else {
                console.log('âŒ GÃ©olocalisation non supportÃ©e');
                console.log('âŒ Test GÃ©olocalisation: Ã‰CHEC');
            }
        }
        
        function simulerGeolocalisation() {
            console.log('ğŸ“ SIMULATION: GÃ©olocalisation Paris');
            
            const userLat = 48.8566;
            const userLon = 2.3522;
            
            console.log(`CoordonnÃ©es simulÃ©es: ${userLat}, ${userLon}`);
            
            // Afficher les Ã©quipements proches
            const proches = trouverEquipementsProches(userLat, userLon, equipementsTest, 5, false);
            console.log(`ğŸ† Top 5 des Ã©quipements les plus proches:`);
            
            proches.forEach((equip, index) => {
                const disponibilite = 100 - equip.tauxOccupation;
                console.log(`${index + 1}. ${equip.equip_nom}`);
                console.log(`   ğŸ“ Distance: ${equip.distance} km`);
                console.log(`   ğŸ“Š DisponibilitÃ©: ${disponibilite}%`);
                console.log(`   ğŸ“ ${equip.commune_nom}`);
                console.log('   ---');
            });
        }
        
        function executerTousTests() {
            console.log('ğŸš€ EXÃ‰CUTION DE TOUS LES TESTS');
            console.log('================================');
            
            setTimeout(() => testerFormuleHaversine(), 100);
            setTimeout(() => testerEquipementsProches(), 500);
            setTimeout(() => testerGeolocalisation(), 1000);
            setTimeout(() => simulerGeolocalisation(), 1500);
        }
        
        function effacerConsole() {
            document.getElementById('console-output').textContent = 'Console effacÃ©e...\n';
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ Page de test chargÃ©e');
            afficherEquipementsTest();
            console.log('âœ… SystÃ¨me de distance prÃªt pour les tests');
        });
    </script>
</body>
</html>